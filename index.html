<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deutsch-Trainer: Intensivkurs</title>
    <meta name="description" content="Interaktiver Deutsch Trainer: 18 Einheiten zu Verben, Grammatik, FÃ¤llen, Modalverben und mehr. Intensives Ãœben durch Wiederholung.">
    <meta name="theme-color" content="#f59e0b">
    <script>
        tailwind = {};
        tailwind.config = {
            safelist: [
                { pattern: /(bg|text|border)-(indigo|emerald|red|orange|blue|purple|pink|yellow|teal|cyan|fuchsia|lime|gray|amber)-(50|100|200|500|600|700)/ },
                'bg-green-500','bg-yellow-600','bg-gray-800','bg-gray-900'
            ]
        };
    </script>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter Font & local styles (use relative path for GitHub Pages) -->
    <link rel="stylesheet" href="./styles.css">
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 text-gray-800">
<noscript class="m-4 p-4 bg-yellow-100 border border-yellow-300 rounded-xl text-sm text-yellow-900 font-medium">Diese Anwendung benÃ¶tigt JavaScript. Bitte aktiviere JavaScript, um den Deutsch-Trainer zu verwenden.</noscript>

<!-- Onboarding Modal (Appears first) -->
<div id="onboarding-modal" class="fixed inset-0 flex items-center justify-center p-4 transition-opacity duration-300">
    <div class="bg-white border-t-8 border-yellow-500 p-8 rounded-3xl shadow-2xl max-w-md w-full text-center transform transition-all scale-100">
        <div class="mb-6 flex justify-center">
            <span class="text-6xl">ðŸ‡©ðŸ‡ª</span>
        </div>
        <h2 class="text-3xl font-extrabold text-gray-900 mb-3 tracking-tight">Deutsch-Trainer</h2>
        <p class="text-lg text-gray-600 mb-8 font-medium">Intensives Training von Verben und Grammatik durch Wiederholung.</p>

        <div class="bg-yellow-50 rounded-xl p-5 mb-8 text-left">
            <ul class="space-y-3 text-sm text-yellow-900 font-medium">
                <li class="flex items-start"><span class="mr-2">ðŸ¥¨</span> Praktische Grammatik</li>
                <li class="flex items-start"><span class="mr-2">ðŸ§ </span> FÃ¤lle: Nominativ, Akkusativ, Dativ</li>
                <li class="flex items-start"><span class="mr-2">ðŸ”„</span> Starke und trennbare Verben</li>
                <li class="flex items-start"><span class="mr-2">ðŸŽ¯</span> 18 Progressive Einheiten</li>
            </ul>
        </div>

        <button
                id="start-learning-button"
                class="w-full py-4 px-6 bg-yellow-500 text-black font-bold text-lg rounded-xl shadow-lg hover:bg-yellow-400 hover:shadow-xl transition duration-200 transform hover:-translate-y-1 active:scale-95"
                onclick="startLearning()"
        >
            Jetzt starten
        </button>
    </div>
</div>

<!-- Unit Selector Screen -->
<div id="unit-selector" class="app-container w-full hidden pb-12">
    <div class="text-center mb-10 mt-4">
        <h2 class="text-4xl font-black text-gray-900 mb-2">Lektionen</h2>
        <p class="text-gray-500 font-medium">WÃ¤hle ein Thema, um zu beginnen</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div id="units-grid-container" class="contents"></div>
    </div>

    <!-- All Drills Button -->
    <div class="mt-8">
        <button
                onclick="showExplanation('all')"
                class="w-full p-6 bg-gray-800 text-white rounded-2xl shadow-lg hover:bg-gray-900 transition duration-200 flex items-center justify-between group"
        >
            <span class="text-left flex flex-col">
                <span class="text-xl font-bold">Gesamtwiederholung</span>
                <span class="text-gray-400 text-sm mt-1">Mischung aus allen 18 Einheiten (Meister-Modus)</span>
            </span>
            <span class="text-2xl group-hover:translate-x-2 transition-transform">ðŸš€</span>
        </button>
    </div>
</div>

<!-- Explanation View -->
<div id="explanation-view" class="app-container w-full bg-white shadow-2xl rounded-3xl overflow-hidden hidden flex flex-col min-h-[600px] p-6 md:p-8">
    <div class="flex-grow flex flex-col items-center text-center">
        <div class="w-16 h-16 rounded-full flex items-center justify-center text-3xl mb-6 shadow-sm transition-theme" id="exp-icon-bg">
            ðŸ“–
        </div>
        <h2 id="exp-title" class="text-3xl font-black text-gray-900 mb-2">Unit Title</h2>
        <p id="exp-subtitle" class="text-gray-400 font-medium mb-6 text-sm uppercase tracking-wider">Grammatik-Fokus</p>

        <div id="exp-body" class="explanation-content text-left text-gray-700 leading-relaxed bg-gray-50 p-6 rounded-2xl border border-gray-100 w-full shadow-inner">
            <!-- Content injected via JS -->
        </div>
    </div>

    <div class="mt-6 space-y-3 pt-4 border-t border-gray-100">
        <button
                id="exp-start-btn"
                onclick="initDrills()"
                class="w-full py-4 px-6 text-white font-bold text-lg rounded-xl shadow-lg transition duration-200 hover:-translate-y-1 transform active:scale-95 transition-theme"
        >
            Verstanden! Ãœbungen starten
        </button>
        <button
                onclick="returnToSelector()"
                class="w-full py-3 px-6 text-gray-400 font-semibold rounded-xl hover:text-gray-600 transition text-sm"
        >
            ZurÃ¼ck zum MenÃ¼
        </button>
    </div>
</div>

<!-- Main Drill View -->
<div id="drill-view" class="app-container w-full bg-white shadow-2xl rounded-3xl overflow-hidden hidden flex flex-col min-h-[600px]">

    <!-- Header -->
    <header id="app-header" class="p-6 text-white flex justify-between items-start transition-theme bg-yellow-600">
        <div class="flex-1 pr-4">
            <h1 class="text-2xl font-bold leading-tight" id="unit-title">Deutsch-Ãœbungen</h1>
            <p class="text-white/80 text-sm mt-1 font-medium" id="unit-subtitle">WÃ¤hle eine Einheit</p>
        </div>
        <div class="flex flex-col items-end">
            <button
                    onclick="returnToSelector()"
                    class="p-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-lg text-white transition mb-2"
                    aria-label="SchlieÃŸen"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <span id="user-id" class="text-[10px] uppercase tracking-wider opacity-60 font-mono">LÃ¤dt...</span>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="h-1.5 w-full bg-gray-100">
        <div id="progress-bar" class="h-full bg-green-500 transition-all duration-500 ease-out" style="width: 0%;"></div>
    </div>

    <!-- Main Drill Area -->
    <main class="p-6 flex-grow flex flex-col">

        <!-- Score Counter -->
        <div class="flex justify-between items-center mb-6 text-sm font-bold text-gray-400 uppercase tracking-wide">
            <span>Fortschritt</span>
            <span><span id="drill-count" class="text-gray-800">0</span> / <span id="total-drills">0</span></span>
        </div>

        <!-- Drill Card -->
        <div id="drill-card" class="bg-gray-50 border-2 border-gray-100 p-8 rounded-2xl shadow-sm mb-6 flex flex-col items-center justify-center min-h-[180px] transition-theme text-center">
            <div id="drill-type-badge" class="mb-3 px-3 py-1 bg-white rounded-full text-xs font-bold uppercase tracking-wider shadow-sm text-gray-500 border border-gray-200">
                Bereit?
            </div>
            <div id="current-prompt" class="text-2xl md:text-3xl font-bold text-gray-800 leading-tight mb-2">
                LÃ¤dt...
            </div>
            <div id="drill-hint" class="text-sm text-gray-500 font-medium italic mt-2"></div>
        </div>

        <!-- Input Area -->
        <div class="space-y-4 mb-auto">
            <label for="user-input" class="sr-only">Deine Antwort eingeben</label>
            <input
                    type="text"
                    id="user-input"
                    placeholder="Schreibe auf Deutsch..."
                    class="w-full p-4 text-lg border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-4 focus:ring-yellow-100 focus:border-yellow-500 transition-all duration-200 text-center font-medium placeholder-gray-300 disabled:bg-gray-50 disabled:text-gray-400"
                    disabled
                    autocomplete="off"
                    spellcheck="false"
            >

            <div id="feedback" class="hidden p-4 rounded-xl text-center font-bold animate-fade-in"></div>

            <!-- Buttons Row -->
            <div class="flex gap-3">
                <button
                        id="give-up-button"
                        class="w-1/3 py-4 font-bold text-gray-500 bg-gray-100 rounded-xl hover:bg-gray-200 transition-colors disabled:opacity-50 text-sm md:text-base flex items-center justify-center gap-1"
                        onclick="handleGiveUp()"
                        disabled
                >
                    <span>ðŸ¤·</span> <span class="hidden md:inline">Keine Ahnung</span><span class="md:hidden">Hilfe</span>
                </button>
                <button
                        id="action-button"
                        class="w-2/3 py-4 px-6 bg-yellow-600 text-white font-bold text-lg rounded-xl shadow-lg hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0 transition-all duration-200 disabled:opacity-50 disabled:transform-none disabled:shadow-none"
                        onclick="handleActionButton()"
                        disabled
                >
                    PrÃ¼fen
                </button>
            </div>
        </div>

        <!-- Reference Table Toggle -->
        <div class="mt-8 pt-6 border-t border-gray-100">
            <button onclick="toggleReference()" class="text-xs font-bold text-gray-400 hover:text-gray-600 uppercase tracking-widest w-full text-center flex items-center justify-center gap-2 transition-colors">
                <span id="ref-toggle-icon">Anzeigen</span> Referenztabelle
            </button>

            <div id="reference-area" class="hidden mt-4 animate-fade-in">
                <div class="reference-table-container bg-white">
                    <table class="w-full text-left text-gray-600">
                        <thead id="ref-table-head" class="text-xs text-white uppercase bg-gray-800 sticky top-0">
                        <!-- Headers injected by JS -->
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                        <tr class="hover:bg-gray-50">
                            <td class="py-3 px-4 font-bold text-gray-900 bg-gray-50 sticky left-0 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]">Ich</td>
                            <td>bin</td><td>habe</td><td>werde</td><td>mache</td><td>fahre</td><td>will</td><td>kann</td><td>habe gemacht</td><td>bin gefahren</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="py-3 px-4 font-bold text-gray-900 bg-gray-50 sticky left-0 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]">Du</td>
                            <td>bist</td><td>hast</td><td>wirst</td><td>machst</td><td>fÃ¤hrst</td><td>willst</td><td>kannst</td><td>hast gemacht</td><td>bist gefahren</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="py-3 px-4 font-bold text-gray-900 bg-gray-50 sticky left-0 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]">Er/Sie/Es</td>
                            <td>ist</td><td>hat</td><td>wird</td><td>macht</td><td>fÃ¤hrt</td><td>will</td><td>kann</td><td>hat gemacht</td><td>ist gefahren</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="py-3 px-4 font-bold text-gray-900 bg-gray-50 sticky left-0 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]">Wir</td>
                            <td>sind</td><td>haben</td><td>werden</td><td>machen</td><td>fahren</td><td>wollen</td><td>kÃ¶nnen</td><td>haben gemacht</td><td>sind gefahren</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="py-3 px-4 font-bold text-gray-900 bg-gray-50 sticky left-0 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]">Ihr</td>
                            <td>seid</td><td>habt</td><td>werdet</td><td>macht</td><td>fahrt</td><td>wollt</td><td>kÃ¶nnt</td><td>habt gemacht</td><td>seid gefahren</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="py-3 px-4 font-bold text-gray-900 bg-gray-50 sticky left-0 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]">Sie/sie</td>
                            <td>sind</td><td>haben</td><td>werden</td><td>machen</td><td>fahren</td><td>wollen</td><td>kÃ¶nnen</td><td>haben gemacht</td><td>sind gefahren</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Firebase SDK -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

    if (firebaseConfig) {
        try {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);

            if (initialAuthToken) {
                signInWithCustomToken(auth, initialAuthToken);
            } else {
                signInAnonymously(auth);
            }

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    document.getElementById('user-id').textContent = user.uid.substring(0, 6);
                }
            });
        } catch (e) {
            console.error("Firebase Init Error:", e);
            document.getElementById('user-id').textContent = "Offline";
        }
    } else {
        document.getElementById('user-id').textContent = "Demo Modus";
    }
</script>

<!-- Application Logic (relative path for GitHub Pages) -->
<script src="./index.js" type="module"></script>
</body>
</html>
